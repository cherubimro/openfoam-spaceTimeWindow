<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>spaceTimeWindow: spaceTimeWindow Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">spaceTimeWindow
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Space-time window extraction and reconstruction for OpenFOAM LES</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">spaceTimeWindow Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A library for space-time window extraction and reconstruction of LES simulations, developed for OpenFOAM.</p>
<p><b>Tested with:</b> OpenFOAM v2512 (openfoam.com)</p>
<blockquote class="doxtable">
<p><b>Trademark Notice:</b> This offering is not approved or endorsed by OpenCFD Limited, producer and distributor of the OpenFOAM software via www.openfoam.com, and owner of the OPENFOAM and OpenCFD trade marks. OPENFOAM is a registered trade mark of OpenCFD Limited, producer and distributor of the OpenFOAM software via www.openfoam.com. </p>
</blockquote>
<h2>Overview</h2>
<p>This library provides three components for extracting a spatial subset from a full LES simulation and reconstructing the flow within that subset using pre-computed boundary conditions:</p>
<ol type="1">
<li><b>spaceTimeWindowExtract</b> - Function object to extract boundary data during the original simulation</li>
<li><b>spaceTimeWindowInitCase</b> - Utility to initialize a reconstruction case from extracted data</li>
<li><b>spaceTimeWindow</b> - Boundary condition to apply extracted data during reconstruction</li>
</ol>
<h2>Workflow</h2>
<p>The workflow is strictly sequential:</p>
<h3>Serial Execution</h3>
<ol type="1">
<li><b>Extraction phase</b>: Run the original simulation with <code>spaceTimeWindowExtract</code> function object</li>
<li><b>Case setup</b>: Run <code>spaceTimeWindowInitCase</code> to configure the reconstruction case</li>
<li><b>Reconstruction phase</b>: Run the solver directly - everything is pre-configured</li>
</ol>
<h3>Parallel Execution</h3>
<ol type="1">
<li><b>Extraction phase</b>: Run the original simulation in parallel with <code>spaceTimeWindowExtract</code> function object<ul>
<li>The extractor automatically forces a field write at the extraction start time</li>
<li>Boundary data is gathered from all processors and written by master</li>
</ul>
</li>
<li><b>Reconstruct fields</b>: Run <code>reconstructPar -time &lt;extractionStartTime&gt;</code> to reconstruct the initial time</li>
<li><b>Case setup</b>: Run <code>spaceTimeWindowInitCase -sourceCase &lt;path&gt;</code> to create subset mesh and initial fields</li>
<li><b>Reconstruction phase</b>: Run the solver on the subset case</li>
</ol>
<div class="fragment"><div class="line"># Example parallel workflow</div><div class="line">cd source-case</div><div class="line">mpirun -np 4 pimpleFoam -parallel    # Extraction happens automatically</div><div class="line"></div><div class="line"># Reconstruct the extraction start time</div><div class="line">reconstructPar -time 0.0001          # Use actual extraction start time</div><div class="line"></div><div class="line"># Initialize the subset case</div><div class="line">cd ../subset-case</div><div class="line">spaceTimeWindowInitCase -sourceCase ../source-case</div><div class="line"></div><div class="line"># Run reconstruction (can be serial or parallel)</div><div class="line">pimpleFoam</div></div><!-- fragment --><h2>Components</h2>
<h3>spaceTimeWindowExtract (Function Object)</h3>
<p>Extracts face-interpolated boundary values at every timestep during the original simulation.</p>
<div class="fragment"><div class="line">functions</div><div class="line">{</div><div class="line">    extractSubset</div><div class="line">    {</div><div class="line">        type            spaceTimeWindowExtract;</div><div class="line">        libs            (spaceTimeWindow);</div><div class="line"></div><div class="line">        <span class="comment">// Define extraction region with bounding box (min max points)</span></div><div class="line">        <span class="comment">// Box must be fully internal to domain (no intersection with boundaries)</span></div><div class="line">        box             ((0.05 -0.25 0.01) (0.90 0.25 0.38));</div><div class="line"></div><div class="line">        outputDir       <span class="stringliteral">&quot;../subset-case&quot;</span>;        <span class="comment">// Output case directory</span></div><div class="line">        fields          (U p nut);               <span class="comment">// Fields to extract</span></div><div class="line"></div><div class="line">        <span class="comment">// Write format for boundary data (optional)</span></div><div class="line">        <span class="comment">// Options: ascii, binary, deltaVarint</span></div><div class="line">        <span class="comment">// Default: ascii</span></div><div class="line">        writeFormat     deltaVarint;</div><div class="line"></div><div class="line">        <span class="comment">// Precision for deltaVarint (optional, default: 6)</span></div><div class="line">        deltaVarintPrecision  6;</div><div class="line"></div><div class="line">        <span class="comment">// Compression for ascii/binary (optional, ignored for deltaVarint)</span></div><div class="line">        <span class="comment">// writeCompression on;</span></div><div class="line"></div><div class="line">        writeControl    timeStep;</div><div class="line">        writeInterval   1;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p><b>Parameters:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Required  </th><th class="markdownTableHeadNone">Default   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">box  </td><td class="markdownTableBodyNone">Bounding box as ((minX minY minZ) (maxX maxY maxZ))  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">outputDir  </td><td class="markdownTableBodyNone">Output case directory for extracted data  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">fields  </td><td class="markdownTableBodyNone">List of fields to extract  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">-   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">writeFormat  </td><td class="markdownTableBodyNone">Format for boundary data: <code>ascii</code>, <code>binary</code>, or <code>deltaVarint</code>  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">ascii   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">deltaVarintPrecision  </td><td class="markdownTableBodyNone">Decimal digits for delta-varint quantization  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">6   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">writeCompression  </td><td class="markdownTableBodyNone">Gzip compression for ascii/binary (ignored for deltaVarint)  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">off   </td></tr>
</table>
<p><b>Field Selection:</b></p>
<p>The <code>fields</code> parameter explicitly lists which fields to extract. Fields are <b>not</b> auto-detected from the turbulence model. Common configurations:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Turbulence Model  </th><th class="markdownTableHeadNone">Recommended fields   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">LES Smagorinsky  </td><td class="markdownTableBodyNone"><code>(U p nut)</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">LES dynamicKEqn  </td><td class="markdownTableBodyNone"><code>(U p nut k)</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RANS k-epsilon  </td><td class="markdownTableBodyNone"><code>(U p nut k epsilon)</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">RANS k-omega SST  </td><td class="markdownTableBodyNone"><code>(U p nut k omega)</code>   </td></tr>
</table>
<p>If a requested field doesn't exist in the simulation, extraction will fail with a "field not found" error.</p>
<p><b>Output structure:</b> </p><div class="fragment"><div class="line">outputDir/</div><div class="line">    constant/</div><div class="line">        polyMesh/               # Subset mesh (only oldInternalFaces patch)</div><div class="line">        boundaryData/</div><div class="line">            oldInternalFaces/</div><div class="line">                points              # Face centres (reference only)</div><div class="line">                extractionMetadata  # Settings and timestep list</div><div class="line">                &lt;time&gt;/</div><div class="line">                    U               # Face-interpolated velocity (or U.dvz)</div><div class="line">                    p               # Face-interpolated pressure (or p.dvz)</div><div class="line">                    nut             # Face-interpolated turbulence viscosity (or nut.dvz)</div><div class="line">    &lt;startTime&gt;/                # Initial subset fields (always ASCII)</div><div class="line">        U</div><div class="line">        p</div><div class="line">        nut</div></div><!-- fragment --><p><b>Note:</b> With <code>writeFormat deltaVarint</code>, boundary data files have <code>.dvz</code> extension (e.g., <code>U.dvz</code>). Initial fields remain ASCII regardless of writeFormat setting.</p>
<p><b>Notes:</b></p><ul>
<li>Box must be <b>fully internal</b> to the domain (no intersection with external boundaries)</li>
<li>The mesh is written with only <code>oldInternalFaces</code> patch (type <code>patch</code>)</li>
<li>Boundary data is written at every timestep (in <code>execute()</code>), not just at write intervals</li>
<li>The <code>extractionMetadata</code> file includes the list of all extracted timesteps (exact directory names)</li>
<li><b>Supports both serial and parallel execution</b></li>
<li>Face values are computed using linear interpolation: <code>U_face = w * U_inside + (1-w) * U_outside</code></li>
</ul>
<p><b>Parallel Execution:</b></p><ul>
<li>The extraction box can span multiple processor domains</li>
<li>Boundary data from all processors is gathered to the master and written as a single file</li>
<li>Processor boundary faces (where the extraction boundary crosses processor boundaries) are handled automatically</li>
<li>Field interpolation correctly exchanges values between processors for faces on processor boundaries</li>
<li><b>Automatic field write</b>: At extraction start time, the extractor forces the solver to write all fields to disk</li>
<li><b>Mesh handling</b>: In parallel mode, only extraction box parameters are written (not the mesh)</li>
<li><code>spaceTimeWindowInitCase</code> creates the subset mesh from the reconstructed source case, ensuring correct cell ordering</li>
</ul>
<p><b>Parallel Extraction Output:</b> </p><div class="fragment"><div class="line">outputDir/</div><div class="line">    constant/</div><div class="line">        polyMesh/</div><div class="line">            extractionBox       # Extraction parameters for mesh creation</div><div class="line">        boundaryData/</div><div class="line">            oldInternalFaces/</div><div class="line">                points              # Face centres (gathered from all processors)</div><div class="line">                extractionMetadata  # Settings, timestep list, nProcs info</div><div class="line">                &lt;time&gt;/</div><div class="line">                    U               # Gathered face-interpolated fields (or U.dvz)</div><div class="line">                    p               # (or p.dvz with deltaVarint)</div><div class="line">                    nut             # (or nut.dvz)</div></div><!-- fragment --><p><b>Important:</b> After parallel extraction, you must run <code>reconstructPar -time &lt;startTime&gt;</code> before <code>spaceTimeWindowInitCase</code>.</p>
<h3>spaceTimeWindowInitCase (Utility)</h3>
<p>Initializes a fully configured reconstruction case from the extracted data.</p>
<div class="fragment"><div class="line"># Run from the extraction output directory</div><div class="line">spaceTimeWindowInitCase -sourceCase ../ufr2-02</div><div class="line"></div><div class="line"># Or specify the extract directory explicitly</div><div class="line">spaceTimeWindowInitCase -sourceCase ../ufr2-02 -extractDir ./subset-case</div></div><!-- fragment --><p><b>Options:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Required   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-sourceCase  </td><td class="markdownTableBodyNone">Source case directory (where extraction ran)  </td><td class="markdownTableBodyNone">yes   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">-extractDir  </td><td class="markdownTableBodyNone">Directory with extracted data (default: cwd)  </td><td class="markdownTableBodyNone">no   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-overwrite  </td><td class="markdownTableBodyNone">Overwrite existing files  </td><td class="markdownTableBodyNone">no   </td></tr>
</table>
<p><b>What it creates:</b></p>
<ol type="1">
<li><code>system/controlDict</code> - With matching solver, deltaT, adjustTimeStep from extraction<ul>
<li><b>Note:</b> <code>endTime</code> is set to the <b>second-to-last</b> available timestep, because the <code>spaceTimeWindow</code> BC reads ahead to the next timestep</li>
</ul>
</li>
<li><code>system/fvSchemes</code>, <code>system/fvSolution</code> - Copied from source case</li>
<li><code>constant/</code> files - All physics properties copied (mandatory for fidelity):<ul>
<li><code>turbulenceProperties</code>, <code>transportProperties</code></li>
<li><code>momentumTransport</code>, <code>thermophysicalProperties</code></li>
<li><code>LESProperties</code>, <code>RASProperties</code>, <code>g</code></li>
</ul>
</li>
<li>Initial field files with <code>spaceTimeWindow</code> BC on <code>oldInternalFaces</code></li>
<li>Turbulence fields (nut, k, epsilon, omega, etc.) with appropriate wall functions</li>
</ol>
<p><b>Parallel case handling:</b></p>
<p>When the extraction was done in parallel (detected by <code>extractionBox</code> file):</p><ul>
<li>Creates subset mesh from the reconstructed source case using the extraction bounding box</li>
<li>Extracts initial fields from the source case at the extraction start time</li>
<li>Requires that <code>reconstructPar -time &lt;startTime&gt;</code> was run on the source case first</li>
</ul>
<p><b>After running:</b> </p><div class="fragment"><div class="line">cd subset-case</div><div class="line">pimpleFoam    # Run directly - everything is configured</div></div><!-- fragment --><h3>spaceTimeWindow (Boundary Condition)</h3>
<p>Reads pre-computed face values from boundaryData and applies them as boundary conditions.</p>
<div class="fragment"><div class="line">oldInternalFaces</div><div class="line">{</div><div class="line">    type            spaceTimeWindow;</div><div class="line">    dataDir         <span class="stringliteral">&quot;constant/boundaryData&quot;</span>;    <span class="comment">// Path to boundaryData</span></div><div class="line">    fixesValue      <span class="keyword">true</span>;                       <span class="comment">// See mass conservation section</span></div><div class="line">    value           uniform (0 0 0);</div><div class="line">}</div></div><!-- fragment --><p><b>Properties:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Property  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Required  </th><th class="markdownTableHeadNone">Default   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dataDir  </td><td class="markdownTableBodyNone">Path to boundaryData directory  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">constant/boundaryData   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">fieldTableName  </td><td class="markdownTableBodyNone">Name of field file (if different from field)  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">field name   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">setAverage  </td><td class="markdownTableBodyNone">Adjust mapped field to match average  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">false   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">offset  </td><td class="markdownTableBodyNone">Offset value added to field  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">Zero   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">fixesValue  </td><td class="markdownTableBodyNone">Report to adjustPhi that values are fixed  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">true   </td></tr>
</table>
<p><b>Notes:</b></p><ul>
<li>Does NO spatial interpolation (values are pre-computed for exact face positions)</li>
<li>Does NO temporal interpolation - requires exact timestep matching with source simulation</li>
<li>Will error if simulation time doesn't match an available timestep</li>
<li>Metadata validation enforces identical <code>deltaT</code> to ensure timestep alignment</li>
</ul>
<h2>Mass Conservation and <code>fixesValue</code></h2>
<p>The <code>fixesValue</code> option controls how <code>adjustPhi()</code> handles flux correction on the <code>oldInternalFaces</code> patch.</p>
<h3>fixesValue = true (default)</h3>
<ul>
<li><code>adjustPhi()</code> excludes this patch from flux correction</li>
<li>Preserves exact boundary values from original simulation</li>
<li>Any mass imbalance is corrected on other adjustable patches (typically outlets)</li>
<li>Use when: You want to preserve the exact extracted boundary values</li>
</ul>
<h3>fixesValue = false</h3>
<ul>
<li><code>adjustPhi()</code> includes this patch in flux correction</li>
<li>Allows small modifications to the flux to ensure mass conservation</li>
<li>The correction is distributed across all faces of this patch</li>
<li>Use when: You want <code>adjustPhi()</code> to heal/repair mass imbalance caused by face interpolation</li>
</ul>
<p><b>Recommendation:</b> For LES reconstruction where accurate inflow physics matter, <code>fixesValue = false</code> may be preferable as it distributes the mass correction uniformly across the <code>oldInternalFaces</code> rather than dumping it all on the outlet.</p>
<h2>Boundary Data Compression</h2>
<p>The <code>writeFormat</code> parameter controls how boundary data files are written. For long LES simulations with many timesteps, storage can become significant.</p>
<h3>Format Comparison</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Format  </th><th class="markdownTableHeadNone">Extension  </th><th class="markdownTableHeadNone">Typical Size  </th><th class="markdownTableHeadNone">Notes   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ascii</code>  </td><td class="markdownTableBodyNone">(none)  </td><td class="markdownTableBodyNone">100% baseline  </td><td class="markdownTableBodyNone">Human-readable, default   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>binary</code>  </td><td class="markdownTableBodyNone">(none)  </td><td class="markdownTableBodyNone">~50%  </td><td class="markdownTableBodyNone">OpenFOAM native binary   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ascii</code> + gzip  </td><td class="markdownTableBodyNone">.gz  </td><td class="markdownTableBodyNone">~10%  </td><td class="markdownTableBodyNone"><code>writeCompression on</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>binary</code> + gzip  </td><td class="markdownTableBodyNone">.gz  </td><td class="markdownTableBodyNone">~8%  </td><td class="markdownTableBodyNone"><code>writeFormat binary</code> + <code>writeCompression on</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>deltaVarint</code>  </td><td class="markdownTableBodyNone">.dvz  </td><td class="markdownTableBodyNone">**~2.7%**  </td><td class="markdownTableBodyNone">Best compression, recommended   </td></tr>
</table>
<h3>ASCII and Binary Formats</h3>
<p>Standard OpenFOAM formats with optional gzip compression:</p>
<div class="fragment"><div class="line"><span class="comment">// ASCII (default, human-readable)</span></div><div class="line">writeFormat     ascii;</div><div class="line"></div><div class="line"><span class="comment">// Binary (smaller, faster I/O)</span></div><div class="line">writeFormat     binary;</div><div class="line"></div><div class="line"><span class="comment">// Either format with gzip compression</span></div><div class="line">writeCompression on;</div></div><!-- fragment --><h3>Delta-Varint Codec (<code>writeFormat deltaVarint</code>)</h3>
<p>A specialized codec optimized for time-series CFD data that achieves ~97% storage reduction:</p>
<p><b>How it works:</b></p><ol type="1">
<li><b>Component-major ordering</b>: Stores all Ux values, then Uy, then Uz (groups similar values)</li>
<li><b>Delta encoding</b>: Stores differences between consecutive values (small deltas)</li>
<li><b>Quantization</b>: Rounds deltas to configurable precision (default: 6 decimal digits)</li>
<li><b>Varint encoding</b>: Variable-length integer encoding (1-9 bytes based on magnitude)</li>
<li><b>Zigzag encoding</b>: Efficient encoding of signed integers</li>
</ol>
<p><b>File format:</b></p><ul>
<li>Magic number: <code>DVZ1</code> (0x315A5644)</li>
<li>Header: element count, component count, precision</li>
<li>First value: stored as raw 8-byte double (exact)</li>
<li>Subsequent values: delta-encoded varints</li>
</ul>
<p><b>Precision:</b></p><ul>
<li><code>deltaVarintPrecision 6</code> means deltas quantized to <code>round(delta * 10^6)</code></li>
<li>Precision loss is ~1e-6 relative to consecutive value differences</li>
<li>For typical CFD data, this is well below solver tolerance</li>
</ul>
<p><b>What uses deltaVarint:</b></p><ul>
<li>Boundary data files only (<code>constant/boundaryData/.../U.dvz</code>, <code>p.dvz</code>)</li>
</ul>
<p><b>Important:</b> When using <code>writeFormat deltaVarint</code>, all other output is written as <b>uncompressed ASCII</b>:</p><ul>
<li>Initial fields (<code>&lt;startTime&gt;/U</code>, <code>p</code>) - ASCII</li>
<li>Subset mesh (<code>constant/polyMesh/</code>) - ASCII</li>
<li>Metadata (<code>extractionMetadata</code>) - ASCII</li>
</ul>
<p>The <code>writeCompression</code> setting is <b>ignored</b> when using deltaVarint. This is intentional because:</p><ol type="1">
<li>Boundary data dominates storage (written every timestep)</li>
<li>Initial fields and mesh are written once</li>
<li>The ~2.7% compression ratio already far exceeds gzip</li>
</ol>
<p><b>Auto-detection:</b> The <code>spaceTimeWindow</code> BC and <code>spaceTimeWindowInitCase</code> automatically detect <code>.dvz</code> files and read them correctly. No configuration needed on the reconstruction side.</p>
<h2>Encryption (Optional)</h2>
<p>Boundary data can be encrypted using X25519 asymmetric encryption (libsodium sealed boxes). This allows extraction with a public key while requiring the private key for reconstruction.</p>
<h3>Building with Encryption Support</h3>
<div class="fragment"><div class="line">cd src/spaceTimeWindow</div><div class="line">export FOAM_USE_SODIUM=1 &amp;&amp; wmake</div><div class="line"></div><div class="line">cd applications/utilities/preProcessing/spaceTimeWindowInitCase</div><div class="line">export FOAM_USE_SODIUM=1 &amp;&amp; wmake</div><div class="line"></div><div class="line">cd ../spaceTimeWindowKeygen</div><div class="line">export FOAM_USE_SODIUM=1 &amp;&amp; wmake</div></div><!-- fragment --><p>Requires libsodium development package (<code>libsodium-dev</code> on Debian/Ubuntu, <code>libsodium-devel</code> on RHEL/Fedora).</p>
<h3>Key Generation</h3>
<div class="fragment"><div class="line">spaceTimeWindowKeygen</div><div class="line"># Output:</div><div class="line"># Public key:  fqzYQ0U8j27tFEr5WzEMylbvXYP+9CAyk0JhwwZ2rwg=</div><div class="line"># Private key: QgzxB5b+DGPQH8exbWDe18n4Kv0nu5gqljI2RPBCwl4=</div><div class="line">#</div><div class="line"># IMPORTANT: Store the private key securely!</div></div><!-- fragment --><h3>Encrypted Extraction</h3>
<p>Add the public key to the function object configuration:</p>
<div class="fragment"><div class="line">functions</div><div class="line">{</div><div class="line">    extractSubset</div><div class="line">    {</div><div class="line">        type            spaceTimeWindowExtract;</div><div class="line">        libs            (spaceTimeWindow);</div><div class="line"></div><div class="line">        box             ((0.05 -0.25 0.01) (0.90 0.25 0.38));</div><div class="line">        outputDir       <span class="stringliteral">&quot;../subset-case&quot;</span>;</div><div class="line">        fields          (U p nut);</div><div class="line"></div><div class="line">        writeFormat     deltaVarint;</div><div class="line">        deltaVarintPrecision  7;</div><div class="line"></div><div class="line">        <span class="comment">// Encryption with X25519 public key</span></div><div class="line">        publicKey       <span class="stringliteral">&quot;fqzYQ0U8j27tFEr5WzEMylbvXYP+9CAyk0JhwwZ2rwg=&quot;</span>;</div><div class="line"></div><div class="line">        writeControl    timeStep;</div><div class="line">        writeInterval   1;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>Encrypted files have <code>.enc</code> extension (e.g., <code>U.dvz.enc</code> for compressed+encrypted).</p>
<h3>Decryption During Case Initialization</h3>
<div class="fragment"><div class="line">cd subset-case</div><div class="line">spaceTimeWindowInitCase -sourceCase ../source-case</div><div class="line"># Prompts for private key (no echo):</div><div class="line"># Enter private key (base64):</div></div><!-- fragment --><p>The public key is automatically derived from the private key. All encrypted boundary data is decrypted in-place during initialization.</p>
<h3>Security Properties</h3>
<ul>
<li><b>Sealed box encryption</b>: Anonymous sender, only recipient (private key holder) can decrypt</li>
<li><b>X25519 key derivation</b>: Public key can be computed from private key</li>
<li><b>No unencrypted data on disk</b>: Encryption happens before writing during extraction</li>
<li><b>Compile-time optional</b>: Without <code>FOAM_USE_SODIUM=1</code>, encryption code is not included</li>
</ul>
<h2>Time Settings Validation</h2>
<p>The library enforces identical time settings between extraction and reconstruction to ensure exact timestep matching.</p>
<h3>Metadata Storage</h3>
<p>During extraction, <code>spaceTimeWindowExtract</code> writes an <code>extractionMetadata</code> file containing:</p>
<div class="fragment"><div class="line">constant/boundaryData/oldInternalFaces/extractionMetadata</div></div><!-- fragment --><p>Contents:</p><ul>
<li><code>openfoamVersion</code> - OpenFOAM version string (e.g., "v2512")</li>
<li><code>openfoamApi</code> - OpenFOAM API number (e.g., 2512)</li>
<li><code>solver</code> - Application/solver name used during extraction (e.g., "pimpleFoam")</li>
<li><code>deltaT</code> - Time step used during extraction</li>
<li><code>adjustTimeStep</code> - Whether adaptive time stepping was enabled</li>
<li><code>timePrecision</code> - Floating point precision for time values</li>
<li><code>extractionStartTime</code> - Start time of extraction</li>
<li><code>fixedDeltaT</code> - Fixed deltaT from controlDict (if specified)</li>
</ul>
<h3>Validation During Reconstruction</h3>
<p>The <code>spaceTimeWindow</code> BC validates these settings on first use:</p>
<ol type="1">
<li><b>OpenFOAM API mismatch</b> - Warning if reconstruction uses different OpenFOAM version</li>
<li><b>Solver mismatch</b> - Warning if reconstruction uses different solver</li>
<li><b>deltaT mismatch</b> - Fatal error if reconstruction uses different time step</li>
<li><b>adjustTimeStep mismatch</b> - Fatal error if adaptive time stepping setting differs</li>
<li><b>adjustTimeStep warning</b> - Warning if both use adaptive time stepping (time steps may not align exactly)</li>
</ol>
<p>Example error message: </p><div class="fragment"><div class="line">FOAM FATAL ERROR:</div><div class="line">Time step mismatch between extraction and reconstruction!</div><div class="line">    Extraction deltaT: 8.53e-04</div><div class="line">    Current deltaT:    1e-03</div><div class="line">    Patch: oldInternalFaces</div><div class="line"></div><div class="line">    The spaceTimeWindow BC requires identical time settings</div><div class="line">    for exact timestep matching.</div><div class="line">    Please set deltaT = 8.53e-04 in system/controlDict</div></div><!-- fragment --><p><b>Best Practice:</b> Use fixed time stepping (<code>adjustTimeStep = no</code>) with identical <code>deltaT</code> values for both extraction and reconstruction. All timesteps from the source simulation are required.</p>
<h2>Building</h2>
<div class="fragment"><div class="line"># Build the library (BC and function object)</div><div class="line">cd src/spaceTimeWindow</div><div class="line">wmake</div><div class="line"></div><div class="line"># Build the utility</div><div class="line">cd applications/utilities/preProcessing/spaceTimeWindowInitCase</div><div class="line">wmake</div></div><!-- fragment --><h2>Requirements</h2>
<ul>
<li><b>OpenFOAM v2512</b> (openfoam.com) or compatible ESI-OpenCFD version</li>
<li>The subset mesh must be created using <code>subsetMesh</code> with exact cell extraction (no interpolation)</li>
<li>For parallel extraction: MPI environment for distributed execution</li>
</ul>
<h2>RANS Compatibility</h2>
<p>The library works with transient RANS simulations (e.g., <code>pimpleFoam</code> with k-epsilon or k-omega SST):</p>
<p><b>Supported:</b></p><ul>
<li>Transient RANS with time-varying boundary conditions</li>
<li>All transported turbulence variables (k, epsilon, omega)</li>
<li>Wall function handling (though subset typically has no walls)</li>
</ul>
<p><b>Not supported:</b></p><ul>
<li>Steady-state RANS (<code>simpleFoam</code>) - the "space-time" concept requires time evolution</li>
</ul>
<p><b>Example for k-omega SST:</b> </p><div class="fragment"><div class="line">fields    (U p nut k omega);</div></div><!-- fragment --><p>The extraction and reconstruction process is identical to LES. Ensure all transported turbulence quantities are included in the <code>fields</code> list.</p>
<h2>Example Case</h2>
<p>The <code>examples/ufr2-02</code> directory contains a complete LES test case:</p>
<ul>
<li><b>Case</b>: ERCOFTAC UFR2-02 - Flow around a square cylinder at Re = 22,000</li>
<li><b>Acknowledgment</b>: Mesh generation script by Niklas Nordin (ERCOFTAC Classic Collection Database Case 043)</li>
<li><b>Reference</b>: Lyn et al. (1995) J. Fluid Mech. 304, 285-319</li>
</ul>
<div class="fragment"><div class="line">cd examples/ufr2-02</div><div class="line">./Allrun</div></div><!-- fragment --><p>See <code>examples/ufr2-02/README.md</code> for detailed instructions.</p>
<h2>References</h2>
<p><b>Acknowledging this work</b></p>
<p>If this software has been useful in your research, please consider:</p><ul>
<li>Citing: Anton, A.-A. (2011). *"Space-Time Window Reconstruction in Parallel High Performance Numeric Simulations. Application for CFD"*, PhD Thesis, Politehnica University of Timisoara. Available at: <a href="https://dspace.upt.ro/jspui/handle/123456789/643">https://dspace.upt.ro/jspui/handle/123456789/643</a></li>
</ul>
<p>{Anton2011, author = "Alin-Adrian Anton", title = "Space-Time Window Reconstruction in High-Performance Numeric Simulations: Application for {CFD}", school = "Universitatea Politehnica Timișoara", year = "2011", month = "November", type = "PhD thesis", address = "Timișoara, Romania", publisher = "Editura Politehnica", isbn = "978-606-554-390-4", url = "https://dspace.upt.ro/jspui/handle/123456789/643" }</p>
<ul>
<li>Or acknowledging: "This work made use of openfoam-spaceTimeWindow https://dev.cs.upt.ro/alin.anton/openfoam-spaceTimeWindow"</li>
</ul>
<p><b>Additional references:</b></p><ul>
<li>Lyn, D.A., Einav, S., Rodi, W., Park, J.-H. (1995). *"A laser-Doppler velocimetry study of ensemble-averaged characteristics of the turbulent near wake of a square cylinder"*, J. Fluid Mech. 304, 285-319</li>
<li>ERCOFTAC Classic Collection Database: Case 043</li>
</ul>
<h2>Limitations</h2>
<ul>
<li>No spatial interpolation - mesh topology must match exactly</li>
<li>No temporal interpolation - all timesteps from source simulation required</li>
<li>Boundary data must cover full reconstruction time range</li>
<li>Steady-state solvers not supported (requires transient simulation)</li>
<li>For parallel extraction, <code>reconstructPar</code> must be run before <code>spaceTimeWindowInitCase</code> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Jan 31 2026 01:14:09 for spaceTimeWindow by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
